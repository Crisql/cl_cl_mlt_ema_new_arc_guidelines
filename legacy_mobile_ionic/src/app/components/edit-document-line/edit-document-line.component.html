<ion-header>
  <ion-toolbar>
    <ion-title>{{ "PRODUCT DETAIL.PRODUCT DETAIL" | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="Dismiss()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="ValidateFields()">
        <ion-icon slot="icon-only" name="checkmark"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>

  <form [formGroup]="productForm">
    <ion-item>
      <ion-label position="stacked">
        {{ "PRODUCT DETAIL.CODE" | translate }}
      </ion-label>
      <ion-input type="text" [readonly]="true" formControlName="ItemCode">
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">{{
        "PRODUCT DETAIL.NAME" | translate
      }}</ion-label>
      <ion-input type="text" [readonly]="true" formControlName="ItemName">
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.QUANTITY" | translate }}
      </ion-label>
      <ion-input
        type="number"
        (ionChange)="ChangeData()"
        formControlName="Quantity"
      >
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">{{
        "PRODUCT DETAIL.PRICE" | translate
      }}</ion-label>
      <ion-input
        type="number"
        [readonly]="VerifyPermission('M_Sales_Documents_EditLinePrice')"
        formControlName="UnitPrice"
        (ionChange)="ChangeData()"
      >
      </ion-input>
    </ion-item>

    <ion-item *ngIf="product.UoMMasterData">
      <ion-label position="stacked">{{
        "PRODUCT DETAIL.UOM" | translate
      }}</ion-label>
      <ion-select formControlName="UoMEntry" (ionChange)="OnChangeProductUoM($event.target.value)">
        <ion-select-option *ngFor="let unit of product.UoMMasterData" [value]="unit.UoMEntry">
          {{ unit.UomName }}</ion-select-option
        >
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.DISCOUNT" | translate }}
      </ion-label>
      <ion-input
        type="number"
        [readonly]="VerifyPermission('M_Sales_Documents_EditLineDiscount')"
        (focusin)="DeleteDiscount()"
        (focusout)="VerifyDiscountValue()"
        (ionChange)="ChangeData()"
        formControlName="DiscountPercent"
      >
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.DISCOUNT PRICE" | translate }}
      </ion-label>
      <ion-input
        type="number"
        [readonly]="true"
        formControlName="PriceDiscount"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">{{
        "PRODUCT DETAIL.TOTAL" | translate
      }}</ion-label>
      <ion-input
        type="number"
        [readonly]="true"
        formControlName="Total"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.TAX ONLY" | translate }}
      </ion-label>
      <ion-select
        [disabled]="VerifyPermission('M_Sales_Documents_EditLineBonus')"
        formControlName="TaxOnly"
        (ionChange)="ChangeData()"
      >
        <ion-select-option value="tYES">{{currentLang === 'es' ? 'SÃ­': 'Yes'}}</ion-select-option>
        <ion-select-option value="tNO">{{currentLang === 'es' ? 'No': 'No'}}</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">
        {{ "PRODUCT DETAIL.TAX CODE" | translate }}
      </ion-label>
      <ion-select
        [disabled]="VerifyPermission('M_Sales_Documents_EditLineTax')"
        formControlName="TaxCode"
        (ionChange)="ChangeTax($event.target.value)">
        <ion-select-option value="Seleccione">
          Seleccione
        </ion-select-option>
        <ion-select-option *ngFor="let tax of taxes" [value]="tax.TaxCode">
          {{ tax.TaxCode }}
        </ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.TAX RATE" | translate }}
      </ion-label>
      <ion-input type="number" [readonly]="true" 
      formControlName="TaxRate">
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.TOTAL DISCOUNT" | translate }}
      </ion-label>
      <ion-input
        type="number"
        [readonly]="true"
        formControlName="TotalDesc"
      >
      </ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked"
        >{{ "PRODUCT DETAIL.TOTAL TAX" | translate }}
      </ion-label>
      <ion-input
        type="number"
        [readonly]="true"
        formControlName="TotalImp"
      >
      </ion-input>
    </ion-item>

  </form>

  <ion-item (click)="ShowAvailableWarehouses()">
    <ion-label position="floating">{{
      "PRODUCT DETAIL.WAREHOUSE" | translate
    }}</ion-label>
    <ion-input [ngModel]="this.selectedWarehouse?.WhsName || ''" [disabled]="VerifyPermission('M_Sales_Documents_EditLineWarehouse') || !!product.SerialNumber" type="text" [readonly]="true" >
    </ion-input>
    <ion-badge  style="background-color: transparent; color: rgb(9, 9, 9); font-size: 10px; font-weight: 400;" slot="end">
      {{"PRODUCT DETAIL.AVAILABLE" | translate}}: {{ selectedWarehouseInfo?.OnHand || 0 }}
    </ion-badge> 
  </ion-item>

  <ion-item *ngIf="allocations && allocations.length" (click)="ShowAvailableLocations()">
    <ion-label position="floating">{{
      "PRODUCT DETAIL.ALLOCATION" | translate
    }}</ion-label>
    <ion-input  [ngModel]="this.selectedBinCode" [disabled]="!!product.SerialNumber" type="text" [readonly]="true" >
    </ion-input>
    <ion-badge style="background-color: transparent; color: rgb(9, 9, 9); font-size: 10px; font-weight: 400;" slot="end">
      {{"PRODUCT DETAIL.AVAILABLE" | translate}}: {{ itemLocationStock || 0 }}
    </ion-badge> 
  </ion-item>

  <div class="inventory-detail-header-container">
    <ion-label>{{ "PRODUCT DETAIL.STOCKDETAIL" | translate }}</ion-label>
    <ion-button
      fill="clear"
      [disabled]="network.type === 'none'"
      (click)="showProductInventory = !showProductInventory"
    >
      <ion-icon
        [name]="!showProductInventory ? 'add' : 'remove'"
        slot="icon-only"
      ></ion-icon>
    </ion-button>
  </div>

  <div *ngIf="showProductInventory" style="font-size: .9rem; padding: 5px 10px 10px 15px;">
    
    <ion-row>
      <ion-col size="6">{{ "PRODUCT DETAIL.COMMITED" | translate }}</ion-col>
      <ion-col size="6" style="text-align: center;">{{ selectedWarehouseInfo.IsCommited }}</ion-col>

    </ion-row>

    <ion-row>
      <ion-col size="6">{{ "PRODUCT DETAIL.REQUESTED" | translate }}</ion-col>
      <ion-col size="6" style="text-align: center;">{{ selectedWarehouseInfo.OnOrder }}</ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="6">{{ "PRODUCT DETAIL.AVAILABLE" | translate }}</ion-col>
      <ion-col size="6" style="text-align: center;">{{ selectedWarehouseInfo.OnHand }}</ion-col>
    </ion-row>

  </div>
</ion-content>
