<div class="container">
  <app-action-buttons [actionButtons]="actionButtons" (onActionButtonClicked)="OnActionButtonClicked($event)">
    <mat-tab-group
      [selectedIndex]="index"
      (selectedIndexChange)="OnTabChange($event)"
      class="mobile-tab"
    >
      <mat-tab [tabIndex]="0" label="Asignación de roles">
        <div class="margin top">
          <div class="form-fields top-margin">
            <mat-form-field appearance="outline" class="form-field w-100 ">
              <mat-label>Compañía</mat-label>
              <mat-select
                [formControl]="company"
                (selectionChange)="GetRolesByUsers()"
              >
                <mat-option *ngFor="let comp of companies" [value]="comp.Id">
                  {{ comp.Name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field w-100 ">
              <mat-label>Usuario</mat-label>
              <mat-select
                [formControl]="user"
                (selectionChange)="GetRolesByUsers()">
                <mat-option *ngFor="let user of users" [value]="user.Id">
                  {{ user.Name }} {{ user.LastName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <section class="main-container">
          <fieldset>
            <legend>
              Resultados de búsqueda
            </legend>
            <cl-table
              [Id]="rolByUserTableId"
              [ShouldPaginateRequest]="shouldPaginateRequestAssignRol"
              [HasStandardHeaders]="hasStandardHeaders"
              [ShouldSplitPascal]="shouldSplitPascal"
              [MappedColumns]="roleByUserMappedColumns"
              [Records]="roles"
              [RecordsCount]="roles.length"
              [HasItemsSelection]="hasItemsSelectionRoleByUser"
              [ShouldEmitRows]="hasItemsSelectionRoleByUser"
              [BackgroundTransparent]="true">
            </cl-table>
          </fieldset>
          <section class="table-container">

          </section>
        </section>
      </mat-tab>
      <mat-tab [tabIndex]="1" label="Permisos del rol">
        <div class="options top-margin">
          <form [formGroup]="assignRolePermissionsFilterForm">
            <div class="filter form-fields">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Rol</mat-label>
                <mat-select
                  formControlName="roleId"
                  (selectionChange)="GetPermissionsByRole()"
                >
                  <mat-option *ngFor="let rol of roles" [value]="rol.Id">
                    {{ rol.Name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Criterio de búsqueda</mat-label>
                <input matInput formControlName="searchCriteria"
                       (keyup)="GetFilteredPermissionsByRoleIfSearchCriteriaIsEmpty($event)"/>
              </mat-form-field>
              <div class="btn-filter">
                <div>
                  <app-action-buttons [isIntoMatTab]="false"
                                      [form]="assignRolePermissionsFilterForm"
                                      [actionButtons]="actionButtonsFilter"
                                      (onActionButtonClicked)="OnActionButtonClicked($event)">
                  </app-action-buttons>
                </div>
              </div>
            </div>
          </form>
          <div class="table-actions">
            <button mat-stroked-button (click)="OnClickAssignAllPerms()" class="w-100">
              Asignar todos
            </button>

            <button mat-stroked-button (click)="OnClickUnassignAllPerms()" class="w-100">
              Desasignar todos
            </button>
          </div>
        </div>
        <section class="main-container">
          <section class="table-container">
            <fieldset>
              <legend>
                Resultados de la búsqueda
              </legend>
              <cl-table
                [Id]="permsByRoleTableId"
                [ShouldPaginateRequest]="shouldPaginateRequestPermissionRol"
                [HasStandardHeaders]="hasStandardHeaders"
                [ShouldSplitPascal]="shouldSplitPascal"
                [MappedColumns]="permsByRoleMappedColumns"
                [Records]="filteredPermissions"
                [RecordsCount]="filteredPermissions.length"
                [ShouldEmitRows]="hasItemsSelectionPermsByRole"
                [HasItemsSelection]="hasItemsSelectionPermsByRole"
                [BackgroundTransparent]="true">
              </cl-table>
            </fieldset>
          </section>
        </section>
      </mat-tab>
      <mat-tab [tabIndex]="2" label="Roles">
        <section class="main-container">
          <section class="table-container">
            <fieldset class="top-margin">
              <cl-table
                [Id]="roleTableId"
                [ShouldPaginateRequest]="shouldPaginateRequestRoles"
                [HasStandardHeaders]="hasStandardHeaders"
                [ShouldSplitPascal]="shouldSplitPascal"
                [MappedColumns]="mappedColumns"
                [Records]="roles"
                [RecordsCount]="roles.length"
                [HasItemsSelection]="hasItemsSelection"
                [Buttons]="buttons"
                [BackgroundTransparent]="true">
              </cl-table>
            </fieldset>
          </section>
        </section>
      </mat-tab>
      <mat-tab [tabIndex]="3" label="Permisos">
        <section class="main-container">
          <section>
            <form [formGroup]="permissionsFilterForm">
              <div class="filter top-margin">
                <mat-form-field appearance="outline">
                  <mat-label>Criterio de búsqueda</mat-label>
                  <input matInput formControlName="searchCriteria"
                         (keyup)="GetFilteredPermissionsIfSearchCriteriaIsEmpty($event)"/>
                </mat-form-field>
                <div class="btn-filter">
                  <div>
                    <app-action-buttons [isIntoMatTab]="false"
                                        [form]="permissionsFilterForm"
                                        [actionButtons]="actionButtonsFilter"
                                        (onActionButtonClicked)="OnActionButtonClicked($event)">
                    </app-action-buttons>
                  </div>
                </div>
              </div>
            </form>
          </section>
          <section class="table-container">
            <fieldset>
              <cl-table
                [Id]="permsTableId"
                [ShouldPaginateRequest]="shouldPaginateRequestPermission"
                [HasStandardHeaders]="hasStandardHeaders"
                [ShouldSplitPascal]="shouldSplitPascal"
                [MappedColumns]="mappedColumnsPermission"
                [Records]="permissions"
                [RecordsCount]="permissions.length"
                [HasItemsSelection]="hasItemsSelection"
                [Buttons]="buttons"
                [BackgroundTransparent]="true">
              </cl-table>
            </fieldset>
          </section>
        </section>
      </mat-tab>
    </mat-tab-group>
  </app-action-buttons>
</div>
