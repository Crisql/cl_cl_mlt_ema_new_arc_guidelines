<section class="multi-bottoms">
  <app-action-buttons [form]="documentForm" class="column-2" [actionButtons]="actionButtons" [isIntoMatTab]="false"
                      (onActionButtonClicked)="OnActionButtonClicked($event)">
  </app-action-buttons>
  <div class="doc-margin">
    <input #file (change)="UploadFileXML($event)"
           class="form-control form-control-sm btn-light shadow-sm btn-st" type="file"
           placeholder="file" style="display: none !important">
  </div>
</section>
<fieldset class="main-container">
  <legend>
    Encabezado
  </legend>
  <form [formGroup]="documentForm" class="grid-container">
    <mat-form-field appearance="outline" class="col-lg-4 col-md-6 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Código de proveedor</mat-label>
      <input readonly type="text" matInput formControlName="CardCode">
      <mat-error *ngIf="documentForm.controls['CardCode'].errors?.['CardCode']">
        El campo es requerido
      </mat-error>
    </mat-form-field>

    <div class="col-lg-8 col-md-10 col-sm-12">
      <div class="flex">
        <mat-form-field appearance="outline" class="input-group" style="margin-bottom: -1em">
          <mat-label>Nombre del proveedor</mat-label>
          <input readonly placeholder="Buscar proveedor" type="text" formControlName="CardName" type="text" matInput>

          <mat-error *ngIf="documentForm.controls['CardName'].errors?.['required']">
            Campo requerido
          </mat-error>
        </mat-form-field>
        <button matTooltip="Buscar proveedores"
                type="button"
                mat-flat-button color="primary"
                class="e-bill-search"
                (click)="ShowModalSearchBusinnesPartner()">
          <mat-icon>search</mat-icon>
        </button>
      </div>
    </div>

    <mat-form-field appearance="outline" class="col-lg-3 col-md-12 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Moneda</mat-label>
      <mat-select matInput formControlName="DocCurrency" (selectionChange)="SelectCurrency()">
        <mat-option *ngFor="let curr of currencies" [value]="curr.Id">
          {{ curr.Name }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="documentForm.controls['DocCurrency'].errors?.['required']">
        Campo requerido
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-3 col-md-12 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Almacén</mat-label>
      <mat-select matInput formControlName="WareHouse" (selectionChange)="SelectWarehouse()">
        <mat-option *ngFor="let whs of warehouses" [value]="whs.WhsCode">
          {{ whs.WhsName }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="documentForm.controls['WareHouse'].errors?.['required']">
        Campo requerido
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-3 col-md-12 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Lista de Precios</mat-label>
      <mat-select formControlName="PriceList"
                  (selectionChange)="SelectPriceList($event.value)"
                  [disabled]="(this.lines && this.lines.length > 0) || !canChangePriceList">
        <mat-option *ngFor="let price of priceLists" [value]="price.ListNum">
          {{ price.ListName }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="documentForm.controls['PriceList'].errors?.['required']">
        Campo requerido
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-3 col-md-12 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Encargado de compras</mat-label>
      <mat-select formControlName="SalesPersonCode">
        <mat-option *ngFor="let person of salesPerson" [value]="person.SlpCode">
          {{ person.SlpName }}
        </mat-option>
        <mat-error *ngIf="documentForm.controls['SalesPersonCode'].errors?.['required']">
          El campo es requerido
        </mat-error>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-4 col-md-12 col-sm-12">
      <mat-label>Fecha de contabilización</mat-label>
      <input matInput [matDatepicker]="pickerDocDate" formControlName="DocDate">
      <mat-datepicker-toggle matSuffix [for]="pickerDocDate"></mat-datepicker-toggle>
      <mat-datepicker #pickerDocDate></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-4  col-md-12 col-sm-12">
      <mat-label>{{ docDueDataLabel }}</mat-label>
      <input matInput [matDatepicker]="pickerDocDueDate" formControlName="DocDueDate">
      <mat-datepicker-toggle matSuffix [for]="pickerDocDueDate"></mat-datepicker-toggle>
      <mat-datepicker #pickerDocDueDate></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-4 col-md-12 col-sm-12">
      <mat-label>Fecha del documento</mat-label>
      <input matInput [matDatepicker]="pickerTaxDate" formControlName="TaxDate">
      <mat-datepicker-toggle matSuffix [for]="pickerTaxDate"></mat-datepicker-toggle>
      <mat-datepicker #pickerTaxDate></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="col-lg-12 col-md-12 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Comentario</mat-label>
      <input matInput formControlName="Comments">
    </mat-form-field>
    <mat-form-field appearance="outline" class="col-lg-1 col-md-2 col-sm-12" style="margin-bottom: -1em">
      <mat-label>Cant.</mat-label>
      <input matInput type="number" min="1" formControlName="Quantity">
      <mat-error *ngIf="documentForm.controls['Quantity'].errors?.['min']">
        Cantidad permitida mayor a 0
      </mat-error>
    </mat-form-field>

    <div class="col-lg-10 col-md-10 col-sm-12">
      <app-item [display]="true" [items]="items" (onItemSelected)="OnSelectItem($event)"
                (refresh)="GetItems()"></app-item>
    </div>

    <div class="col-lg-1 col-md-2 col-sm-12">
      <mat-checkbox class="example-margin" formControlName="ShowItemDetail">Consulta</mat-checkbox>
    </div>

  </form>
</fieldset>
<fieldset class="top-margin udf-fieldset" *ngIf="isVisible || this.IsVisibleAttachTable">
  <mat-tab-group>
    <mat-tab *ngIf="isVisible" label="Udfs">
      <cl-dynamics-udfs-presentation
        [Id]="UdfsId"
        [ApiUrl]="ApiUrl"
        [UdfsCategory]="DBODataEndPoint"
        [UdfsGroup]="'null'"
      >
      </cl-dynamics-udfs-presentation>
    </mat-tab>

    <mat-tab label="Adjuntos" *ngIf="this.IsVisibleAttachTable">

      <div style="display: flex; justify-content: flex-end; align-content: center; padding: 5px;">
        <button mat-flat-button color="primary" (click)="attach_file.click()">
          <mat-icon>
            attach_file
          </mat-icon>
          Adjuntar
        </button>
      </div>

      <input multiple style="display: none;" #attach_file type="file"
             accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt,.xls,.ppt,.xlsx,.pptx" (change)="OnAttachFile($event)">
      <cl-table [Id]="attachmentTableId"
                [ShouldPaginateRequest]="false"
                [HasStandardHeaders]="true"
                [ShouldSplitPascal]="false"
                [MappedColumns]="attachmentLineMappedColumns"
                [Records]="documentAttachment.Attachments2_Lines"
                [RecordsCount]="documentAttachment.Attachments2_Lines.length"
                [Buttons]="attachmentTableButtons"
                [ItemsPeerPage]="5"
                [PageSizeOptions]="[5, 10, 20]"
                [BackgroundTransparent]="true"
                ScrollHeight="400px">
      </cl-table>
    </mat-tab>
  </mat-tab-group>
</fieldset>
<fieldset class="mt-1">
  <legend>
    Documento
  </legend>
  <cl-table [Id]="lineTableId"
            [ShouldPaginateRequest]="shouldPaginateRequest"
            [HasStandardHeaders]="hasStandardHeaders"
            [ShouldSplitPascal]="shouldSplitPascal"
            [MappedColumns]="lineMappedColumns"
            [Records]="lines"
            [RecordsCount]="lines.length"
            [DropdownColumns]="dropdownColumns"
            [DropdownList]="dropdownList"
            [HasItemsSelection]="hasItemsSelection"
            [Buttons]="buttons"
            [CheckboxColumns]="checkboxColumns"
            [DropdownDiffBy]="dropdownDiffBy"
            [DropdownDiffList]="dropdownDiffList"
            [DisableDragAndDrop]="disableDragAndDrop"
            [BackgroundTransparent]="true">
  </cl-table>

  <section>
    <div class="flex-container">
      <div class="total-area">
        <div class="flex-items">
          <table class="table-totales">
            <tr>
              <td class="bg-subtotal">Subtotal</td>
              <td class="bg-montos">
              <span>
                {{ GetSymbol() }} {{ DisplaySubtotal() | number: TO_FIXED_TOTALDOCUMENT }}
              </span>
              </td>
            </tr>
            <tr>
              <td class="bg-subtotal">Descuento</td>
              <td class="bg-montos">
              <span>
                {{ GetSymbol() }} {{ DisplayDiscount() | number: TO_FIXED_TOTALDOCUMENT }}
              </span>
              </td>
            </tr>
            <tr>
              <td class="bg-subtotal">Impuesto</td>
              <td class="bg-montos">
              <span>
                {{ GetSymbol() }} {{ DisplayTaxes() | number: TO_FIXED_TOTALDOCUMENT }}
              </span>
              </td>
            </tr>
            <tr *ngIf="retentionProcessEnabled">
              <td class="bg-subtotal">Retención</td>
              <td class="bg-montos total-retention-container">
              <span>
                  {{ GetSymbol() }} {{ DisplayRetention() | number: TO_FIXED_TOTALDOCUMENT }}
                </span>
                <button matTooltip="Total de Retenciones" type="button" mat-flat-button color="primary"
                        class="btn-info-retention" (click)="ShowInformationModalForCurrentRetentions()">
                  <mat-icon class="icon-retention">info</mat-icon>
                </button>
              </td>
            </tr>
          </table>
        </div>
        <div class="flex-items total-align">
          <div class="label-total">
            <label>Total</label>
          </div>
          <div class="div-total">
           <span class="hover-content">
                <span
                  class="conversion-tooltip">
                  {{ GetConversionSymbol() }} {{ DisplayTotal(1) | number: TO_FIXED_TOTALDOCUMENT }}
                </span>
             {{ GetSymbol() }} {{ DisplayTotal(2) | number: TO_FIXED_TOTALDOCUMENT }}
              </span>
          </div>
        </div>
      </div>


    </div>
  </section>
</fieldset>
